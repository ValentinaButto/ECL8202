<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>The bootstrap method</title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/spacelab.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="fluid-row" id="header">



<h1 class="title toc-ignore">The bootstrap method</h1>

</div>


<div id="data" class="section level2">
<h2>Data</h2>
<p>For this lab, we will use the dataset <a href="sphagnum_cover.csv">sphagnum_cover.csv</a>, from the paper:</p>
<blockquote>
<p>Maanavilja, L., Kangas, L., Mehtätalo, L. and Tuittila, E.‐S. (2015), Rewetting of drained boreal spruce swamp forests results in rapid recovery of Sphagnum production. J Appl Ecol, 52: 1355-1363. <a href="https://doi.org/10.1111/1365-2664.12474">doi:10.1111/1365-2664.12474</a>)</p>
</blockquote>
<p>This dataset contains measurements of the percentage cover of sphagnum moss (<em>sphcover</em>) for 36 boreal swamps divided into three types (<em>habitat</em>): <em>Dr</em> = drained, <em>Re</em> = rewetted et <em>Un</em> = undrained.</p>
<pre class="r"><code>cover &lt;- read.csv(&quot;sphagnum_cover.csv&quot;)
str(cover)</code></pre>
<pre><code>## &#39;data.frame&#39;:    36 obs. of  3 variables:
##  $ site    : chr  &quot;AmLuxx&quot; &quot;EvLuPa&quot; &quot;EvLuVK&quot; &quot;HeLuxx&quot; ...
##  $ habitat : chr  &quot;Un&quot; &quot;Un&quot; &quot;Un&quot; &quot;Un&quot; ...
##  $ sphcover: num  35.3 56.2 46.6 56 54.3 ...</code></pre>
</div>
<div id="estimation-of-mean-cover-for-drained-swamps" class="section level2">
<h2>1. Estimation of mean cover for drained swamps</h2>
<ol style="list-style-type: lower-alpha">
<li>From the dataset, extract the <em>sphcover</em> values for drained swamps. Calculate the mean percentage cover and its standard error from the usual formula (based on standard deviation and sample size). Finally, calculate the 95% confidence interval based on the <span class="math inline">\(t\)</span> distribution:</li>
</ol>
<p><span class="math display">\[(\bar{x} + t_{(n-1)0.025} s_{\bar{x}}, \bar{x} + t_{(n-1)0.975} s_{\bar{x}})\]</span></p>
<p><em>Reminder</em>: The function <code>qt(p, df)</code> gives the quantile corresponding to a given cumulative probability <code>p</code>, for a <span class="math inline">\(t\)</span> distribution with <code>df</code> degrees of freedom.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>Simulate 10,000 bootstrap samples for the mean calculated in a). What is its standard error according to the bootstrap? Does this statistic appear biased?</p></li>
<li><p>How does the bootstrap distribution differ from a normal distribution? To answer this question, it may be useful to draw a quantile-quantile plot (in the code below, <code>res</code> is the result of the bootstrap):</p></li>
</ol>
<pre class="r"><code>qqnorm(res$t)
qqline(res$t)</code></pre>
<ol start="4" style="list-style-type: lower-alpha">
<li>Calculate the 95% confidence interval of the mean using the BCa method. How does it differ from the one calculated in a) using the classical formula? Can you explain this difference based on the result in c)?</li>
</ol>
</div>
<div id="estimation-of-differences-between-habitats" class="section level2">
<h2>2. Estimation of differences between habitats</h2>
<ol style="list-style-type: lower-alpha">
<li>Here is the distribution of <em>sphcover</em> values in each habitat type.</li>
</ol>
<pre class="r"><code>library(ggplot2)
ggplot(cover, aes(x = habitat, y = sphcover)) +
    geom_boxplot()</code></pre>
<p><img src="01E-Bootstrap_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>What are the assumptions of a classical ANOVA model that would describe sphagnum moss cover by habitat type? Do these assumptions appear to be met here?</p>
<ol start="2" style="list-style-type: lower-alpha">
<li><p>Fit the <code>sphcover ~ habitat</code> linear model to the <code>cover</code> dataset. See the summary of the model results with the <code>summary</code> function and the confidence intervals of the coefficients with the <code>confint</code> function. What is the interpretation of each coefficient? Are the confidence intervals plausible?</p></li>
<li><p>Create a function with arguments <code>x</code> and <code>i</code>, which fits the linear model in b) by replacing the original data set (<code>data = cover</code>) with <code>data = x[i, ]</code>, and then returns the coefficients of the model with the function <code>coef</code>. Then, apply <code>boot</code> to the <code>cover</code> dataset with the function created and perform 10,000 replicates.</p></li>
</ol>
<p><em>Notes</em></p>
<ul>
<li><p>When the first argument of `boot’ is a dataset, it is the rows of that dataset that are resampled.</p></li>
<li><p>Since the statistic calculated by the function has several values (each of the coefficients), the <code>t</code> element of the <code>boot</code> result is a matrix rather than a vector. The columns of this matrix correspond to each of the coefficients in order. You can calculate a statistic for each column with the function <code>apply</code>, e.g. <code>apply(res$t, 2, mean)</code>. Here, <code>2</code> indicates to calculate the <code>mean</code> function per column (<code>1</code> would mean per row).</p></li>
</ul>
<ol start="4" style="list-style-type: lower-alpha">
<li>The application of the bootstrap in c) resamples across all rows, so that the number of observations in each habitat type varies from sample to sample. If it is preferable to consider these numbers as fixed quantities, habitat types can be defined as strata by adding the argument <code>strata = as.factor(cover$habitat)</code> to the <code>boot</code> function. (The conversion of the variable <code>habitat</code> to a factor is necessary here.)</li>
</ol>
<p>Repeat the analysis in c) with stratified resampling and compare the standard errors obtained for each coefficient.</p>
<ol start="5" style="list-style-type: lower-alpha">
<li><p>Calculate the confidence interval for the <code>habitatUn</code> coefficient according to the result of the bootstrap in d). Note that you need to add the argument <code>index = 3</code> to the function <code>boot.ci</code> to tell R to calculate the interval for the 3rd coefficient.</p></li>
<li><p>Finally, we will resample the model residuals.</p></li>
</ol>
<ul>
<li><p>Fit a linear model as in b), then add to the dataset <code>cover</code> a column for the model’s <code>fitted</code> values.</p></li>
<li><p>Write a function that creates a new dataset by adding a resampled vector <code>x[i]</code> to the expected values to produce a new response variable, then fits a model with this new response variable to the habitat.</p></li>
<li><p>Simulate 10,000 samples with the <code>boot</code> function, using as arguments (1) the residuals vector (<code>residuals</code>) of the model and (2) the function created above. Do not specify strata. Recalculate the mean, standard error and 95% confidence interval of the coefficients.</p></li>
</ul>
<p>Is resampling the residuals a good choice for these data?</p>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
